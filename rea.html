<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Draconic Control 3x2</title>
    <style>
        /* Шрифт, похожий на Minecraft/OpenComputers */
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        body {
            background-color: #050505;
            color: #eee;
            margin: 0;
            padding: 0;
            font-family: 'VT323', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
        }

        /* КОНТЕЙНЕР МОНИТОРА (Соотношение 3:2) */
        #monitor-frame {
            position: relative;
            width: 95vw;
            max-width: 1200px; /* Максимальная ширина */
            aspect-ratio: 3 / 2; /* ЖЕСТКОЕ СООТНОШЕНИЕ 3:2 */
            background-color: #111;
            border: 15px solid #333;
            box-shadow: 0 0 40px rgba(0, 153, 255, 0.15);
            display: flex;
            flex-direction: column;
        }

        /* СЕТКА (ВЕРХНЯЯ ЧАСТЬ) - 5 КАРТОЧЕК */
        .top-section {
            height: 65%; /* 65% высоты экрана под реакторы */
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5%;
            padding: 1%;
            background-color: #111;
        }

        .card {
            background-color: #222;
            border: 2px solid #222;
            display: flex;
            flex-direction: column;
            padding: 5px;
            position: relative;
            cursor: pointer;
        }
        
        .card:active { border-color: #fff; }

        .card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 1.8cqw; /* Шрифт зависит от ширины контейнера */
        }

        .lbl-blue { color: #0099FF; font-weight: bold; }
        .lbl-gray { color: #555; }
        .lbl-good { color: #44FF44; }
        .lbl-warn { color: #FFAA00; }
        .lbl-bad  { color: #FF3333; }

        /* ПРОГРЕСС БАРЫ */
        .bar-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
            flex-grow: 1;
        }

        .bar-row {
            width: 100%;
        }

        .bar-text {
            font-size: 1.5cqw;
            margin-bottom: 2px;
            white-space: nowrap;
        }

        .bar-track {
            width: 100%;
            height: 1.2cqw;
            background-color: #333;
        }

        .bar-fill {
            height: 100%;
            width: 0%;
            transition: width 0.2s linear;
        }

        .btn-detail {
            margin-top: auto;
            background-color: #0099FF;
            color: #000;
            text-align: center;
            font-size: 1.5cqw;
            padding: 2px 0;
            font-weight: bold;
        }

        /* ИНФО (НИЖНЯЯ ЧАСТЬ) */
        .bottom-section {
            height: 35%;
            background-color: #181818;
            border-top: 4px solid #0099FF;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .info-header {
            position: absolute;
            top: -16px;
            background-color: #111;
            color: #0099FF;
            padding: 0 15px;
            font-size: 2cqw;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            width: 90%;
            text-align: center;
            font-size: 2.2cqw;
            margin-bottom: 15px;
        }

        .profit-text {
            font-size: 3cqw;
            color: #44FF44;
        }

        .footer {
            position: absolute;
            bottom: 5px;
            left: 10px;
            font-size: 1.2cqw;
            color: #444;
        }

        /* ДЕТАЛЬНОЕ ОКНО (OVERLAY) */
        #detail-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.95);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .detail-panel {
            width: 80%;
            height: 80%;
            background-color: #222;
            border: 2px solid #555;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .detail-title { font-size: 4cqw; color: #0099FF; margin-bottom: 20px; border-bottom: 2px solid #444; width: 100%; text-align: center; }
        .detail-stats { font-size: 3cqw; width: 100%; line-height: 1.6; }
        
        .detail-btns {
            margin-top: auto;
            display: flex;
            gap: 20px;
            width: 100%;
            justify-content: center;
        }

        .oc-btn {
            border: none;
            padding: 15px 30px;
            font-family: 'VT323', monospace;
            font-size: 2.5cqw;
            cursor: pointer;
            min-width: 120px;
        }
        
        .btn-close { position: absolute; top: 10px; right: 10px; background: #ddd; color: #000; font-size: 2cqw; padding: 5px 10px; cursor: pointer; }

        /* ЦВЕТА */
        .bg-good { background: #44FF44; color: #000; }
        .bg-bad { background: #FF3333; color: #fff; }
        .bg-warn { background: #FFAA00; color: #000; }
        .bg-blue { background: #0099FF; color: #000; }
        .bg-gray { background: #444; color: #aaa; }

        .c-shield { background: #00FFFF; }
        .c-fuel { background: #00AA00; }
        .c-heat { background: linear-gradient(90deg, #44FF44, #FFAA00, #FF3333); }

        .blink { animation: blinker 1s linear infinite; background-color: #FF3333 !important; color: #fff; }
        @keyframes blinker { 50% { opacity: 0.5; } }

        /* WIZARD */
        #wizard {
            position: absolute;
            top:0; left:0; width:100%; height:100%;
            background:#000;
            z-index:200;
            color: #0f0;
            font-size: 2cqw;
            padding: 40px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
    </style>
</head>
<body>

    <div id="monitor-frame">
        
        <div id="wizard">
            <div id="wizard-text">Initializing DesOope OS...</div>
        </div>

        <div class="top-section" id="grid"></div>

        <div class="bottom-section">
            <div class="info-header">ОБЩАЯ СВОДКА СИСТЕМЫ</div>
            <div class="info-grid">
                <div style="color: #eee">АКТИВНЫЕ: <span id="s-active" style="color:#44FF44">0/5</span></div>
                <div style="color: #44FF44">ГЕНЕРАЦИЯ: <span id="s-gen">0</span> RF/t</div>
                <div style="color: #FFAA00">ПОТРЕБЛЕНИЕ: <span id="s-drain">0</span> RF/t</div>
            </div>
            <div class="profit-text">
                ПРИБЫЛЬ: <span id="s-profit">0</span> RF/t
            </div>
            <div class="footer">DesOope Control System v3.2 | Resolution: 3x2 High Density</div>
        </div>

        <div id="detail-overlay">
            <div class="detail-panel">
                <div class="btn-close" onclick="closeDetail()">[X] НАЗАД</div>
                <div class="detail-title" id="d-title">РЕАКТОР #1</div>
                <div class="detail-stats">
                    <div>Температура: <span id="d-temp" style="color:#44FF44">0</span> C</div>
                    <div>Мощность поля: <span id="d-shield" style="color:#00FFFF">0</span> %</div>
                    <div>Топливо: <span id="d-fuel" style="color:#00AA00">100</span> %</div>
                    <div>Генерация: <span id="d-gen" style="color:#eee">0</span> RF/t</div>
                    <div>Поток выхода: <span id="d-out" style="color:#FFAA00">0</span> RF/t</div>
                </div>
                <div class="detail-btns" id="d-btns">
                    </div>
            </div>
        </div>

    </div>

<script>
    // === КОНФИГУРАЦИЯ ===
    const LOGIC = {
        maxTemp: 8000,
        startTemp: 2000,
        forceAuto: 7500,
        maxShield: 10000000,
        maxFuel: 10000
    };

    // Данные реакторов
    let reactors = Array.from({length: 5}, (_, i) => ({
        id: i,
        state: 'offline', // offline, charging, warm_ready, online, stopping
        temp: 20,
        shield: 0,
        fuel: 10000,
        gen: 0,
        drain: 0,
        outFlow: 0,
        auto: true
    }));

    let selectedId = null;

    // === СИМУЛЯТОР (LOOP) ===
    setInterval(() => {
        reactors.forEach(r => {
            if (r.state === 'charging') {
                // Зарядка щита
                r.shield += 80000;
                if (r.shield > LOGIC.maxShield) r.shield = LOGIC.maxShield;
                r.drain = 500000;
                
                // Легкий нагрев при зарядке
                if (r.shield > LOGIC.maxShield * 0.5 && r.temp < 2100) {
                    r.temp += 15; 
                }
                
                // Готов к пуску?
                if (r.temp >= LOGIC.startTemp) r.state = 'warm_ready';

            } else if (r.state === 'warm_ready') {
                // Ждет нажатия кнопки, поддерживает температуру
                if (r.temp < 2000) r.temp += 10;
                r.shield = LOGIC.maxShield; // Держим щит полным

            } else if (r.state === 'online') {
                // РАБОТА
                // 1. Температура стремится к 8000
                if (r.temp < LOGIC.maxTemp) r.temp += 25;
                else if (r.temp > LOGIC.maxTemp + 100) r.temp -= 15;

                // 2. Генерация (зависит от темп)
                r.gen = Math.floor((r.temp / 8000) * 1200000); // 1.2M макс
                r.outFlow = Math.floor(r.gen * 0.9); // Выкачиваем 90%
                r.drain = Math.floor(r.gen * 0.1);   // 10% на щит

                // 3. Топливо тратится
                r.fuel -= 2; 
                if (r.fuel < 0) r.fuel = 0;

                // 4. Авто-режим форсированный
                if (r.temp > LOGIC.forceAuto) r.auto = true;

            } else if (r.state === 'stopping') {
                // Остывание
                r.temp -= 80;
                r.gen = 0;
                r.drain = 0;
                if (r.temp <= 20) {
                    r.temp = 20;
                    r.state = 'offline';
                }
            } else {
                // Offline
                r.gen = 0; r.drain = 0; r.outFlow = 0;
            }
        });
        render();
    }, 100);

    // === РЕНДЕР ===
    function render() {
        const grid = document.getElementById('grid');
        let html = '';
        let totalGen = 0, totalDrain = 0, activeCnt = 0;

        reactors.forEach(r => {
            if(r.state === 'online') activeCnt++;
            totalGen += r.gen;
            totalDrain += r.drain;

            // Цвета и тексты
            let statusTxt = "ОТКЛЮЧЕН";
            let statusClass = "lbl-bad";
            if (r.state === 'charging') { statusTxt = "ЗАРЯДКА"; statusClass = "lbl-blue"; }
            if (r.state === 'warm_ready') { statusTxt = "ГОТОВ К ПУСКУ"; statusClass = "lbl-warn"; }
            if (r.state === 'online') { statusTxt = "РАБОТА"; statusClass = "lbl-good"; }
            if (r.state === 'stopping') { statusTxt = "ОСТЫВАНИЕ"; statusClass = "lbl-gray"; }

            // Бары
            let tempPct = (r.temp / 10000) * 100;
            let shieldPct = (r.shield / LOGIC.maxShield) * 100;
            let fuelPct = (r.fuel / LOGIC.maxFuel) * 100;

            let fuelBarClass = "c-fuel";
            if (fuelPct < 10) fuelBarClass = "blink"; // Мигание если мало топлива

            html += `
            <div class="card" onclick="openDetail(${r.id})">
                <div class="card-header">
                    <span class="lbl-blue">R-${r.id+1}</span>
                    <span class="${statusClass}">${statusTxt}</span>
                </div>
                <div class="bar-group">
                    <div class="bar-row">
                        <div class="bar-text">T: ${Math.floor(r.temp)}C</div>
                        <div class="bar-track"><div class="bar-fill c-heat" style="width:${tempPct}%"></div></div>
                    </div>
                    <div class="bar-row">
                        <div class="bar-text">S: ${Math.floor(shieldPct)}%</div>
                        <div class="bar-track"><div class="bar-fill c-shield" style="width:${shieldPct}%"></div></div>
                    </div>
                    <div class="bar-row">
                        <div class="bar-text">F: ${Math.floor(fuelPct)}%</div>
                        <div class="bar-track"><div class="bar-fill ${fuelBarClass}" style="width:${fuelPct}%"></div></div>
                    </div>
                </div>
                <div class="btn-detail">ПОДРОБНО</div>
            </div>`;
        });

        grid.innerHTML = html;

        // Сводка
        document.getElementById('s-active').innerText = `${activeCnt}/5`;
        document.getElementById('s-gen').innerText = fmt(totalGen);
        document.getElementById('s-drain').innerText = fmt(totalDrain);
        let profit = totalGen - totalDrain;
        let pEl = document.getElementById('s-profit');
        pEl.innerText = fmt(profit);
        pEl.style.color = profit > 0 ? '#44FF44' : '#FF3333';

        if (selectedId !== null) updateDetail(reactors[selectedId]);
    }

    // === ДЕТАЛЬНОЕ ОКНО ===
    function openDetail(id) {
        selectedId = id;
        document.getElementById('detail-overlay').style.display = 'flex';
        render();
    }

    function closeDetail() {
        selectedId = null;
        document.getElementById('detail-overlay').style.display = 'none';
    }

    function updateDetail(r) {
        document.getElementById('d-title').innerText = `РЕАКТОР #${r.id+1} - УПРАВЛЕНИЕ`;
        document.getElementById('d-temp').innerText = Math.floor(r.temp);
        document.getElementById('d-shield').innerText = Math.floor((r.shield/LOGIC.maxShield)*100);
        document.getElementById('d-fuel').innerText = Math.floor((r.fuel/LOGIC.maxFuel)*100);
        document.getElementById('d-gen').innerText = fmt(r.gen);
        document.getElementById('d-out').innerText = fmt(r.outFlow);

        let btnsHtml = '';

        // Кнопка АВТО
        let autoStyle = r.auto ? "bg-good" : "bg-gray";
        let autoTxt = r.auto ? "АВТО: ВКЛ" : "АВТО: ВЫКЛ";
        if (r.temp > LOGIC.forceAuto) { autoStyle = "bg-warn"; autoTxt = "FORCED"; }
        btnsHtml += `<button class="oc-btn ${autoStyle}" onclick="toggleAuto(${r.id})">${autoTxt}</button>`;

        // СТОП (всегда)
        btnsHtml += `<button class="oc-btn bg-bad" onclick="action(${r.id}, 'stop')">СТОП</button>`;

        // КОНТЕКСТНАЯ КНОПКА (ЗАРЯДИТЬ / ПУСК)
        if (r.state === 'offline') {
            btnsHtml += `<button class="oc-btn bg-blue" onclick="action(${r.id}, 'charge')">ЗАРЯДИТЬ</button>`;
        } else if (r.state === 'charging') {
            btnsHtml += `<button class="oc-btn bg-gray">ЗАРЯДКА...</button>`;
        } else if (r.state === 'warm_ready') {
            btnsHtml += `<button class="oc-btn bg-good blink" onclick="action(${r.id}, 'start')">ПУСК</button>`;
        }

        document.getElementById('d-btns').innerHTML = btnsHtml;
    }

    function action(id, type) {
        let r = reactors[id];
        if (type === 'charge') r.state = 'charging';
        if (type === 'start') r.state = 'online';
        if (type === 'stop') r.state = 'stopping';
    }

    function toggleAuto(id) {
        let r = reactors[id];
        if (r.temp < LOGIC.forceAuto) r.auto = !r.auto;
    }

    function fmt(n) {
        if (n > 1000000) return (n/1000000).toFixed(2) + "M";
        if (n > 1000) return (n/1000).toFixed(1) + "k";
        return Math.floor(n);
    }

    // === WIZARD ANIMATION ===
    window.onload = () => {
        const wiz = document.getElementById('wizard-text');
        const steps = [
            "Booting DesOope OS...",
            "Checking peripherals...",
            "Found 5 Draconic Reactors...",
            "Loading reactors.cfg...",
            "Starting Interface..."
        ];
        let i = 0;
        let int = setInterval(() => {
            if(i >= steps.length) {
                clearInterval(int);
                document.getElementById('wizard').style.display = 'none';
                return;
            }
            wiz.innerHTML += `<br>> ${steps[i]}`;
            i++;
        }, 600);
    }

</script>
</body>
</html>
